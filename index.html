<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melvindale Digital Display</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use a highly legible humanist sans-serif font (PT Sans) for clarity -->
    <style>
        /* Updated to PT Sans for excellent readability */
        @import url('https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap');

        /* The main container to enforce the 16:9 aspect ratio */
        .tv-frame {
            /* 16:9 ratio is 9 / 16 = 0.5625 = 56.25% padding-bottom */
            padding-bottom: 56.25%;
            height: 0;
            width: 100%;
            /* Limit the size slightly to keep it manageable in the canvas */
            max-width: 1600px;
            position: relative;
            /* Cardinal Red Background */
            background-color: #C41E3A;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin: 2rem auto;
            border-radius: 1.5rem;
            overflow: hidden;
        }

        .tv-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* Updated font family */
            font-family: 'PT Sans', sans-serif; 
            color: white; /* Default text color is white */
            padding: 2%; /* Inner padding for breathing room */
        }
        
        .clock-shadow {
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.4), 0 0 10px rgba(255, 255, 255, 0.6);
        }
        /* Custom font size for the large clock, ensuring huge visibility (slightly reduced for AM/PM) */
        .text-huge-clock {
            font-size: 8rem; /* Reduced from 10rem to accommodate AM/PM */
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .sm\:text-extra-huge-clock {
                font-size: 10rem; /* Reduced from 12rem to accommodate AM/PM */
            }
        }
    </style>
</head>
<body class="bg-gray-900 flex justify-center items-center min-h-screen">

    <div class="tv-frame">
        <div class="tv-content">

            <!-- Location Header (Increased to 4xl/6xl) -->
            <div class="text-4xl sm:text-6xl font-bold mb-6 text-white text-opacity-80">
                Melvindale, MI (EST)
            </div>

            <!-- Digital Clock Display (Increased significantly) -->
            <div id="time-display" class="clock-shadow text-huge-clock sm:text-extra-huge-clock font-extrabold tracking-tight mb-8 leading-none">
                00:00 PM
            </div>

            <!-- Date Display (Increased to 3xl/5xl) -->
            <div id="date-display" class="text-3xl sm:text-5xl font-light text-black mb-10 p-2 rounded-xl bg-white bg-opacity-90 shadow-2xl">
                Loading Date...
            </div>

            <!-- Weather Widget -->
            <div class="weather-widget w-full max-w-xl p-8 bg-white bg-opacity-10 backdrop-blur-sm rounded-xl shadow-2xl border border-white border-opacity-20 flex flex-col items-center">
                <div class="text-xl sm:text-2xl font-bold text-white mb-4 uppercase tracking-wider">Current Weather in Melvindale</div>
                <div class="flex items-center space-x-10">
                    <!-- Weather Icon & Temperature (Icon increased to 6xl, Temp to 7xl) -->
                    <div class="flex items-center space-x-4">
                        <span id="weather-icon" class="text-6xl">...</span>
                        <span id="temperature" class="text-7xl font-bold text-white">--¬∞F</span>
                    </div>

                    <!-- Details (Increased to 2xl) -->
                    <div class="flex flex-col space-y-3 text-2xl text-white text-opacity-90">
                        <div class="flex justify-between w-full">
                            <span class="font-semibold">Condition:</span>
                            <span id="condition">Loading...</span>
                        </div>
                        <div class="flex justify-between w-full">
                            <span class="font-semibold">Humidity:</span>
                            <span id="humidity">--%</span>
                        </div>
                        <div class="flex justify-between w-full">
                            <span class="font-semibold">Wind:</span>
                            <span id="wind">-- mph</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- NWS API CONFIGURATION ---
        // For current, real-time observation data, we query the closest station (Detroit Metro Airport)
        const MELVINDALE_STATION_ID = 'KDTW';
        const NWS_BASE_URL = 'https://api.weather.gov';
        // Required header by NWS API to identify your application
        const NWS_USER_AGENT = 'MelvindaleDigitalDisplay (melvindaledisplay@example.com)';

        // Global object to hold the weather data
        let currentWeatherData = {
            temperature: "--¬∞F",
            condition: "Loading...",
            humidity: "--%",
            wind: "-- mph",
            isLoaded: false
        };

        // Utility function to map NWS short forecasts/descriptions to emojis
        function getIconFromCondition(condition) {
            const c = condition.toLowerCase();
            if (c.includes('sunny') || c.includes('clear')) return '‚òÄÔ∏è';
            if (c.includes('rain') || c.includes('showers')) return 'üåßÔ∏è';
            if (c.includes('snow') || c.includes('sleet')) return 'üå®Ô∏è';
            if (c.includes('thunder')) return '‚õàÔ∏è';
            if (c.includes('cloudy') && !c.includes('partly')) return '‚òÅÔ∏è';
            if (c.includes('partly') || c.includes('mostly sunny')) return '‚õÖ';
            if (c.includes('fog') || c.includes('mist')) return 'üå´Ô∏è';
            return 'üå°Ô∏è'; // Default
        }

        // Utility function for Celsius to Fahrenheit conversion
        function celsiusToFahrenheit(c) {
            if (c === null || c === undefined) return null;
            // Round to the nearest whole number for display
            return Math.round((c * 9/5) + 32);
        }

        // Utility function for Knots to MPH conversion
        function knotsToMph(k) {
            if (k === null || k === undefined) return null;
            // Round to the nearest whole number for display
            return Math.round(k * 1.15078);
        }

        // Function to update only the weather elements on the page
        function updateWeatherElements() {
            document.getElementById('temperature').textContent = currentWeatherData.temperature;
            document.getElementById('condition').textContent = currentWeatherData.condition;
            document.getElementById('humidity').textContent = currentWeatherData.humidity;
            document.getElementById('wind').textContent = currentWeatherData.wind;
            document.getElementById('weather-icon').textContent = getIconFromCondition(currentWeatherData.condition);
        }
        
        // Main function to fetch current observation data from NWS API
        async function fetchWeatherData() {
            console.log("Fetching current observation data from NWS API...");
            
            // 1. Set loading state
            currentWeatherData.condition = "Fetching...";
            updateWeatherElements();

            const observationUrl = `${NWS_BASE_URL}/stations/${MELVINDALE_STATION_ID}/observations/latest`;

            try {
                // Step 1: Get latest observation data from the station
                const obsResponse = await fetch(observationUrl, {
                    headers: { 'User-Agent': NWS_USER_AGENT }
                });

                if (!obsResponse.ok) throw new Error(`Observation API error: ${obsResponse.statusText}`);
                const obsData = await obsResponse.json();
                
                const props = obsData.properties;

                if (props) {
                    // Extract and convert data
                    const tempC = props.temperature.value;
                    const humidityValue = props.relativeHumidity.value; // Already a percentage (0-100)
                    const windKts = props.windSpeed.value;
                    const conditionText = props.textDescription || "N/A";
                    
                    const tempF = celsiusToFahrenheit(tempC);
                    const windMph = knotsToMph(windKts);
                    
                    currentWeatherData = {
                        temperature: tempF !== null ? `${tempF}¬∞F` : '--¬∞F',
                        condition: conditionText,
                        humidity: humidityValue !== null ? `${Math.round(humidityValue)}%` : '--%',
                        wind: windMph !== null ? `${windMph} mph` : '-- mph',
                        isLoaded: true
                    };
                    console.log("Weather data successfully updated from KDTW observation station.");

                } else {
                    currentWeatherData.condition = "Data Unavailable";
                }

            } catch (error) {
                console.error("Failed to fetch observation data:", error);
                currentWeatherData.condition = "API Error (Check Console)";
                currentWeatherData.temperature = "--¬∞F";
                currentWeatherData.humidity = "--%";
                currentWeatherData.wind = "-- mph";
            }
            
            // Update the display regardless of success or failure
            updateWeatherElements();
        }

        // Function to update the time and date
        function updateTimeAndDate() {
            const now = new Date();
            
            // Options for time in EST/EDT (America/Detroit timezone)
            const optionsTime = {
                hour: 'numeric', // Removes leading zero
                minute: '2-digit',
                hour12: true, 
                timeZone: 'America/Detroit'
            };
            
            // Options for date
            const optionsDate = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                timeZone: 'America/Detroit'
            };

            try {
                const timeString = now.toLocaleTimeString('en-US', optionsTime);
                document.getElementById('time-display').textContent = timeString;
                
                const dateString = now.toLocaleDateString('en-US', optionsDate);
                document.getElementById('date-display').textContent = dateString;
            } catch (error) {
                console.error("Error setting time/date:", error);
                document.getElementById('time-display').textContent = "ERROR";
                document.getElementById('date-display').textContent = "Timezone Error";
            }
        }

        // Main initialization function
        function initializeDisplay() {
            // 1. Initial load of time, date, and weather
            updateTimeAndDate();
            fetchWeatherData();
            
            // 2. Set interval for time and date (updates every second)
            setInterval(updateTimeAndDate, 1000); 

            // 3. Set interval for weather update (refresh every 10 minutes, good for observation data)
            // 10 minutes = 10 * 60 * 1000 milliseconds
            const weatherRefreshInterval = 10 * 60 * 1000; 
            setInterval(fetchWeatherData, weatherRefreshInterval);
            console.log(`Weather refresh set to every ${weatherRefreshInterval / 60000} minutes.`);
        }

        // Start the display
        initializeDisplay();
    </script>
</body>
</html>
